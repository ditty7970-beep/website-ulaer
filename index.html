<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Game Cacing Zona Halus</title>
  <style>
    body { 
      margin: 0; 
      background: #111; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      height: 100vh; 
      flex-direction: column;
    }
    canvas { 
      background: radial-gradient(circle at center, #222, #000); 
      border: 3px solid #555; 
      border-radius: 10px; 
      display: block;
    }
    #ui { margin-top: 10px; color: #fff; font-family: Arial, sans-serif; }
    #restartBtn {
      display: none;
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #ff4747;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #restartBtn:hover { background: #e63939; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="ui">Skor: <span id="score">0</span></div>
<button id="restartBtn">Main Lagi</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const restartBtn = document.getElementById("restartBtn");

let snake, dx, dy, targetDx, targetDy, score, foods, speed;
let enemies = [];
let gameOver = false;

// Daftar makanan random
const foodTypes = [
  {emoji:"üçé", size:18, color:"red"},
  {emoji:"üçä", size:18, color:"orange"},
  {emoji:"üçì", size:18, color:"pink"},
  {emoji:"üç¨", size:16, color:"cyan"},
  {emoji:"üç≠", size:22, color:"magenta"},
  {emoji:"‚≠ê", size:20, color:"yellow"}
];

function init(){
  snake = [{x:200, y:200}];
  dx = 2; dy = 0;
  targetDx = 2; targetDy = 0;
  score = 0;
  speed = 2;
  document.getElementById("score").innerText = score;

  // bikin beberapa makanan langsung
  foods = [];
  for(let i=0;i<6;i++){ foods.push(randomFood()); }

  enemies = [
    { body:[{x:100,y:100}], dx:1, dy:0, alive:true },
    { body:[{x:300,y:300}], dx:-1, dy:0, alive:true }
  ];
  gameOver = false;
  restartBtn.style.display = "none";
}

function randomFood(){
  const f = foodTypes[Math.floor(Math.random()*foodTypes.length)];
  return {x:Math.random()*canvas.width, y:Math.random()*canvas.height, type:f};
}

function drawSnake(arr, color1="#ff4747", color2="#a60000"){
  for(let i=0;i<arr.length;i++){
    let seg = arr[i];
    let radius = 10;
    ctx.beginPath();
    let gradient = ctx.createRadialGradient(seg.x, seg.y, 2, seg.x, seg.y, radius);
    gradient.addColorStop(0, color1);
    gradient.addColorStop(1, color2);
    ctx.fillStyle = gradient;
    ctx.arc(seg.x, seg.y, radius, 0, Math.PI*2);
    ctx.fill();
  }
}

function drawEyes(body, dx, dy){
  let head = body[0];
  let angle = Math.atan2(dy, dx);
  let eyeOffsetX = Math.cos(angle + Math.PI/2) * 6;
  let eyeOffsetY = Math.sin(angle + Math.PI/2) * 6;
  let eyes = [
    {x: head.x + eyeOffsetX, y: head.y + eyeOffsetY},
    {x: head.x - eyeOffsetX, y: head.y - eyeOffsetY}
  ];
  eyes.forEach(eye => {
    ctx.beginPath();
    ctx.fillStyle = "white";
    ctx.arc(eye.x, eye.y, 3, 0, Math.PI*2);
    ctx.fill();
    ctx.beginPath();
    ctx.fillStyle = "black";
    ctx.arc(eye.x + dx*0.5, eye.y + dy*0.5, 1.5, 0, Math.PI*2);
    ctx.fill();
  });
}

function drawFoods(){
  foods.forEach(food=>{
    ctx.save();
    ctx.shadowColor = food.type.color;
    ctx.shadowBlur = 15;
    ctx.font = food.type.size + "px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(food.type.emoji, food.x, food.y);
    ctx.restore();
  });
}

function updatePlayer(){
  // halusin gerakan ke target
  dx = dx*0.85 + targetDx*0.15;
  dy = dy*0.85 + targetDy*0.15;

  let head = {x: snake[0].x + dx, y: snake[0].y + dy};
  if(head.x < 0 || head.x > canvas.width || head.y < 0 || head.y > canvas.height){
    gameOver = true;
    restartBtn.style.display = "block";
    return;
  }
  snake.unshift(head);

  let ate = false;
  foods.forEach((food, i)=>{
    if(Math.hypot(head.x-food.x, head.y-food.y)<18){
      score++;
      document.getElementById("score").innerText = score;
      foods[i] = randomFood(); 
      ate = true;
    }
  });
  if(!ate) snake.pop();
}

function updateEnemies(){
  enemies.forEach(enemy=>{
    if(!enemy.alive) return;

    let head = enemy.body[0];

    // cari makanan terdekat
    let target = foods.reduce((a,b)=>(
      Math.hypot(head.x-a.x,head.y-a.y) < Math.hypot(head.x-b.x,head.y-b.y) ? a : b
    ));

    let angle = Math.atan2(target.y - head.y, target.x - head.x);

    // smooth gerakan musuh
    enemy.dx = enemy.dx*0.9 + Math.cos(angle)*0.3;
    enemy.dy = enemy.dy*0.9 + Math.sin(angle)*0.3;

    let speed = 1.5;
    let len = Math.hypot(enemy.dx, enemy.dy);
    enemy.dx = (enemy.dx/len)*speed;
    enemy.dy = (enemy.dy/len)*speed;

    let ehead = {x: head.x + enemy.dx, y: head.y + enemy.dy};
    if(ehead.x<0||ehead.x>canvas.width||ehead.y<0||ehead.y>canvas.height){
      enemy.dx *= -1;
      enemy.dy *= -1;
      ehead = {x: head.x + enemy.dx, y: head.y + enemy.dy};
    }

    enemy.body.unshift(ehead);

    let eAte = false;
    foods.forEach((food,i)=>{
      if(Math.hypot(ehead.x-food.x, ehead.y-food.y)<18){
        foods[i] = randomFood();
        eAte = true;
      }
    });
    if(!eAte) enemy.body.pop();

    // tabrakan player vs musuh
    if(Math.hypot(ehead.x - snake[0].x, ehead.y - snake[0].y)<15){
      gameOver = true;
      restartBtn.style.display = "block";
    }

    // player bunuh musuh
    for(let i=0;i<enemy.body.length;i++){
      if(Math.hypot(snake[0].x - enemy.body[i].x, snake[0].y - enemy.body[i].y)<15){
        enemy.alive = false;
        foods.push({x: enemy.body[i].x, y: enemy.body[i].y, type: foodTypes[Math.floor(Math.random()*foodTypes.length)]});
        setTimeout(()=>{ // respawn setelah 3 detik
          enemy.alive = true;
          enemy.body = [{x:Math.random()*canvas.width,y:Math.random()*canvas.height}];
        },3000);
      }
    }
  });
}

function drawGameOver(){
  ctx.fillStyle = "white";
  ctx.font = "28px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Game Over", canvas.width/2, canvas.height/2);
}

let lastTime = 0;
function loop(timestamp){
  if(timestamp - lastTime > (1000/60)){ // 60 fps lebih halus
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(!gameOver){
      drawFoods();
      drawSnake(snake);
      drawEyes(snake, dx, dy);

      enemies.forEach(enemy=>{
        if(enemy.alive){
          drawSnake(enemy.body,"#47ff47","#008000");
          drawEyes(enemy.body, enemy.dx, enemy.dy);
        }
      });

      updatePlayer();
      updateEnemies();
    } else {
      drawGameOver();
    }
    lastTime = timestamp;
  }
  requestAnimationFrame(loop);
}

restartBtn.addEventListener("click", ()=>{ init(); });

window.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp" && dy>=0){ targetDx=0; targetDy=-speed; }
  if(e.key==="ArrowDown" && dy<=0){ targetDx=0; targetDy=speed; }
  if(e.key==="ArrowLeft" && dx>=0){ targetDx=-speed; targetDy=0; }
  if(e.key==="ArrowRight" && dx<=0){ targetDx=speed; targetDy=0; }
});

// Kontrol sentuh
let touchStartX=0, touchStartY=0;
window.addEventListener("touchstart", e=>{
  const t = e.touches[0];
  touchStartX = t.clientX;
  touchStartY = t.clientY;
});
window.addEventListener("touchend", e=>{
  const t = e.changedTouches[0];
  let dxTouch = t.clientX - touchStartX;
  let dyTouch = t.clientY - touchStartY;
  if(Math.abs(dxTouch) > Math.abs(dyTouch)){
    if(dxTouch > 30){ targetDx=speed; targetDy=0; } 
    if(dxTouch < -30){ targetDx=-speed; targetDy=0; } 
  } else {
    if(dyTouch > 30){ targetDx=0; targetDy=speed; } 
    if(dyTouch < -30){ targetDx=0; targetDy=-speed; } 
  }
});

init();
loop();
</script>
</body>
</html>